#!/bin/sh
##############################################################
pkgbase=libreoffice
vers=7.3.2.2
extlib="https://dev-www.libreoffice.org/src/0168229624cfac409e766913506961a8-ucpp-1.3.2.tar.gz
https://dev-www.libreoffice.org/src/1725634df4bb3dcb1b2c91a6175f8789-GentiumBasic_1102.zip
https://dev-www.libreoffice.org/src/1f5def51ca0026cd192958ef07228b52-rasqal-0.9.33.tar.gz
https://dev-www.libreoffice.org/src/26b3e95ddf3d9c077c480ea45874b3b8-lp_solve_5.5.tar.gz
https://dev-www.libreoffice.org/src/33e1e61fab06a547851ed308b4ffef42-dejavu-fonts-ttf-2.37.zip
https://dev-www.libreoffice.org/src/368f114c078f94214a308a74c7e991bc-crosextrafonts-20130214.tar.gz
https://dev-www.libreoffice.org/src/48d647fbd8ef8889e5a7f422c1bfda94-clucene-core-2.3.3.4.tar.gz
https://dev-www.libreoffice.org/src/5ade6ae2a99bc1e9e57031ca88d36dad-hyphen-2.8.8.tar.gz
https://dev-www.libreoffice.org/src/907d6e99f241876695c19ff3db0b8923-source-code-pro-2.030R-ro-1.050R-it.tar.gz
https://dev-www.libreoffice.org/src/Amiri-0.111.zip
https://dev-www.libreoffice.org/src/CoinMP-1.7.6.tgz
https://dev-www.libreoffice.org/src/EmojiOneColor-SVGinOT-1.3.tar.gz
https://dev-www.libreoffice.org/src/Firebird-3.0.7.33374-0.tar.bz2
https://dev-www.libreoffice.org/src/ReemKufi-0.7.zip
https://dev-www.libreoffice.org/src/Scheherazade-2.100.zip
https://dev-www.libreoffice.org/src/a39f6c07ddb20d7dd2ff1f95fa21e2cd-raptor2-2.0.15.tar.gz
https://dev-www.libreoffice.org/src/a8c2c5b8f09e7ede322d5c602ff6a4b6-mythes-1.2.4.tar.gz
https://dev-www.libreoffice.org/src/alef-1.001.tar.gz
https://dev-www.libreoffice.org/src/box2d-2.3.1.tar.gz
https://dev-www.libreoffice.org/src/c74b7223abe75949b4af367942d96c7a-crosextrafonts-carlito-20130920.tar.gz
https://dev-www.libreoffice.org/src/cppunit-1.15.1.tar.gz
https://dev-www.libreoffice.org/src/culmus-0.133.tar.gz
https://dev-www.libreoffice.org/src/dtoa-20180411.tgz
https://dev-www.libreoffice.org/src/e5be03eda13ef68aabab6e42aa67715e-redland-1.0.17.tar.gz
https://dev-www.libreoffice.org/src/e7a384790b13c29113e22e596ade9687-LinLibertineG-20120116.zip
https://dev-www.libreoffice.org/src/edc4d741888bc0d38e32dbaa17149596-source-sans-pro-2.010R-ro-1.065R-it.tar.gz
https://dev-www.libreoffice.org/src/f543e6e2d7275557a839a164941c0a86e5f2c3f2a0042bfc434c88c6dde9e140-opens___.ttf
https://dev-www.libreoffice.org/src/glm-0.9.9.8.zip
https://dev-www.libreoffice.org/src/gpgme-1.16.0.tar.bz2
https://dev-www.libreoffice.org/src/hunspell-1.7.0.tar.gz
https://dev-www.libreoffice.org/src/libabw-0.1.3.tar.xz
https://dev-www.libreoffice.org/src/libassuan-2.5.5.tar.bz2
https://dev-www.libreoffice.org/src/libcdr-0.1.7.tar.xz
https://dev-www.libreoffice.org/src/libcmis-0.5.2.tar.xz
https://dev-www.libreoffice.org/src/libe-book-0.1.3.tar.xz
https://dev-www.libreoffice.org/src/libepubgen-0.1.1.tar.xz
https://dev-www.libreoffice.org/src/liberation-fonts-ttf-2.1.4.tar.gz
https://dev-www.libreoffice.org/src/liberation-narrow-fonts-ttf-1.07.6.tar.gz
https://dev-www.libreoffice.org/src/libetonyek-0.1.10.tar.xz
https://dev-www.libreoffice.org/src/libexttextcat-3.4.6.tar.xz
http://download.documentfoundation.org/libreoffice/src/${vers%.*}/libreoffice-translations-${vers}.tar.xz
https://dev-www.libreoffice.org/src/libfreehand-0.1.2.tar.xz
https://dev-www.libreoffice.org/src/libgpg-error-1.43.tar.bz2
https://dev-www.libreoffice.org/src/libmspub-0.1.4.tar.xz
https://dev-www.libreoffice.org/src/libmwaw-0.3.21.tar.xz
https://dev-www.libreoffice.org/src/libnumbertext-1.0.8.tar.xz
https://dev-www.libreoffice.org/src/libodfgen-0.1.8.tar.xz
https://dev-www.libreoffice.org/src/liborcus-0.17.2.tar.bz2
https://dev-www.libreoffice.org/src/libpagemaker-0.0.4.tar.xz
https://dev-www.libreoffice.org/src/libqxp-0.0.2.tar.xz
https://dev-www.libreoffice.org/src/libre-hebrew-1.0.tar.gz
https://dev-www.libreoffice.org/src/librevenge-0.0.4.tar.bz2
https://dev-www.libreoffice.org/src/libstaroffice-0.0.7.tar.xz
https://dev-www.libreoffice.org/src/libvisio-0.1.7.tar.xz
https://dev-www.libreoffice.org/src/libwpd-0.10.3.tar.xz
https://dev-www.libreoffice.org/src/libwpg-0.3.3.tar.xz
https://dev-www.libreoffice.org/src/libwps-0.4.12.tar.xz
https://dev-www.libreoffice.org/src/libzmf-0.0.2.tar.xz
https://dev-www.libreoffice.org/src/ltm-1.0.zip
https://dev-www.libreoffice.org/src/mariadb-connector-c-3.1.8-src.tar.gz
https://dev-www.libreoffice.org/src/mdds-2.0.1.tar.bz2
https://dev-www.libreoffice.org/src/noto-fonts-20171024.tar.gz
https://dev-www.libreoffice.org/src/pdfium-4699.tar.bz2
https://dev-www.libreoffice.org/src/poppler-21.11.0.tar.xz
https://dev-www.libreoffice.org/src/poppler-data-0.4.10.tar.gz
https://dev-www.libreoffice.org/src/postgresql-13.5.tar.bz2
https://dev-www.libreoffice.org/src/skia-m97-a7230803d64ae9d44f4e1282444801119a3ae967.tar.xz
https://dev-www.libreoffice.org/src/source-serif-pro-3.000R.tar.gz
https://dev-www.libreoffice.org/src/ttf-kacst_2.01+mry.tar.gz
https://dev-www.libreoffice.org/src/zxing-cpp-1.2.0.tar.gz
https://dev-www.libreoffice.org/src/libcuckoo-93217f8d391718380c508a722ab9acd5e9081233.tar.gz"
url="http://download.documentfoundation.org/libreoffice/src/${vers%.*}/libreoffice-${vers}.tar.xz
	http://download.documentfoundation.org/libreoffice/src/${vers%.*}/libreoffice-dictionaries-${vers}.tar.xz
	http://download.documentfoundation.org/libreoffice/src/${vers%.*}/libreoffice-help-${vers}.tar.xz
	http://ftp.tsukuba.wide.ad.jp/software/apache//ant/binaries/apache-ant-1.10.12-bin.zip $extlib"
commitid=
apply_arch="x86_64 i686 armv7l aarch64"
arch=`uname -m`
build=1
src=libreoffice-${vers}
OPT_CONFIG="--with-ant-home=$W/source/apache-ant-1.10.12/ --without-junit --without-java --with-lang=ja --with-system-boost --with-system-curl --with-system-icu --with-system-harfbuzz --with-system-libxml --with-system-xmlsec --with-system-liblangtag --with-system-nss --with-system-libpng --with-system-epoxy --with-system-jpeg --with-system-expat --with-system-lcms2 --with-system-openldap --with-system-sane --with-system-graphite --with-system-neon --with-system-openssl"
DOCS='COPYING COPYING.LGPL COPYING.MPL ChangeLog README.Solaris README.cross README.md leak-suppress.txt readlicense_oo unusedcode.README'
patchfiles=''
compress=txz
SRC_URL="https://qbilinux.org/pub/source/"
SRC_DIR="/home/archives/source/"
##############################################################

source /usr/src/qbilinux/PackageBuild.def

do_prepare() {
    cd ${S[$1]}
    for patch in $patchfiles ; do
	patch -p1 < $W/$patch
    done

    # make exttarballs directory
    mkdir -p $W/source/exttarballs
    cd $W/source/exttarballs
    for m in $extlib ; do
	ln -sf $W/${m##*/} .
    done
}

do_config() {
    if [ -d ${B[$1]} ] ; then rm -rf ${B[$1]} ; fi

    mkdir ${B[$1]}
    cd ${B[$1]}
    export PKG_CONFIG_PATH=/usr/${libdir}/pkgconfig:/usr/share/pkgconfig
    export LDFLAGS='-Wl,--as-needed' 
    ${S[$1]}/configure --prefix=/usr --libdir=/usr/${libdir} --sysconfdir=/etc \
	    --localstatedir=/var --infodir='${prefix}'/share/info --mandir='${prefix}'/share/man \
	    --with-external-tar=$W/source/exttarballs ${OPT_CONFIG[$1]}
    if [ $? != 0 ]; then
	echo "configure error. $0 script stop"
	exit 255
    fi
}

do_build() {
    cd ${B[$1]}
    export LDFLAGS='-Wl,--as-needed'
    make
    if [ $? != 0 ]; then
	echo "make error. $0 script stop"
	exit 255
    fi
}

do_install() {
    cd ${B[$1]}
    export LDFLAGS='-Wl,--as-needed'
    make distro-pack-install DESTDIR=$P
    if [ $? != 0 ]; then
	echo "make install error. $0 script stop"
	exit 255
    fi

    # add extra func
}

do_package() {
    for i in $pkgbase ; do
        cd $P
        /sbin/makepkg $W/$pkg.$compress <<EOF
y
1
EOF
    done
}

source /usr/src/qbilinux/PackageBuild.func
